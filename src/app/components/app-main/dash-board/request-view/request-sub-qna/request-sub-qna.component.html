<div class="request-sub-qna-container">
  <app-progress-spin [isLoading]="isLoading"/>
  <p-card class="flex flex-wrap flex-column w-full justify-content-center shadow-2">
    <div class="flex grid w-full justify-content-center">
      <div class="m-1 select-none">
        <span>{{qnaHeaderModel.title}}</span>
      </div>
    </div>
    <div class="flex grid w-full justify-content-center">
      <div class="m-1 select-none">
        <span class="m-1">{{qnaHeaderModel.id}}</span>
        <span class="m-1">{{dateToYYYYMMdd(qnaHeaderModel.regDate)}}</span>
        <p-tag class="m-1" [value]="QnAStateToQnAStateDesc(qnaHeaderModel.qnaState)" [severity]="getQnAStateSeverity(qnaHeaderModel.qnaState)"/>
      </div>
    </div>
    <p-card>
      <div class="qna-content">
        <span [innerHTML]="qnaContentModel.content | safeHtml"></span>
      </div>
      <ng-template #footer>
        <p-galleria class="flex m-1 justify-content-center" [value]="qnaContentModel.fileList" indicatorsPosition="bottom" [showItemNavigators]="true" [showIndicators]="true" [showThumbnails]="false" [showIndicatorsOnItem]="false"
                    [containerStyle]="galleriaContainerStyle" [numVisible]="0">
          <ng-template pTemplate="item" let-item>
            <img [src]="getBlobUrl(item)" [alt]="item.originalFilename" class="qna-image"/>
          </ng-template>
          <ng-template pTemplate="caption" let-item>
            <div class="flex">
              <p-button class="align-content-center" size="small" icon="pi pi-download" [rounded]="true" pTooltip="{{downloadFileTooltip | translate}}" (click)="downloadFile(item)" />
              <label class="m-1">{{ellipsis(item.originalFilename)}}</label>
            </div>
          </ng-template>
        </p-galleria>
      </ng-template>
    </p-card>
    <p-accordion class="flex flex-wrap flex-column w-full justify-content-center shadow-4 border-round-sm" [value]="accordionValue"
                 [multiple]="multipleEnable" *ngIf="qnaContentModel.replyList.length > 0">
      <p-accordion-panel *ngFor="let replyModel of qnaContentModel.replyList">
        <p-accordion-header>
          <div>
            <span>{{replyModel.name}}</span>
            <span>{{dateToYYYYMMdd(replyModel.regDate)}}</span>
          </div>
        </p-accordion-header>
        <p-accordion-content>
          <p-card>
            <div class="qna-content">
              <span [innerHTML]="replyModel.content | safeHtml"></span>
            </div>
            <ng-template #footer>
              <p-galleria [value]="replyModel.fileList" indicatorsPosition="bottom" [showItemNavigators]="true" [showIndicators]="true" [showThumbnails]="false" [showIndicatorsOnItem]="false"
                          [containerStyle]="galleriaContainerStyle" [numVisible]="0">
                <ng-template pTemplate="item" let-item>
                  <img [src]="getBlobUrl(item)" [alt]="item.originalFilename" class="qna-image"/>
                </ng-template>
              </p-galleria>
            </ng-template>
          </p-card>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
    <div class="m-1 w-full max-w-screen" *ngIf="canReply">
      <p-editor #quillEditor id="quillEditor" [(ngModel)]="content" (onTextChange)="editorChange($event)" (onInit)="quillOnInit($event)" />
      <div class="flex grid justify-content-center m-2">
        <p-button class="field align-content-center" size="small" [disabled]="!saveAble" (click)="saveReplyData()">{{"common-desc.save" | translate}}</p-button>
        <p-button class="field align-content-center" size="small" (click)="fileUpload()">{{"common-desc.add" | translate}}</p-button>
        <p-card class="w-fit field" *ngIf="uploadFileBuffModel.length > 0">
          <p-galleria [value]="uploadFileBuffModel" indicatorsPosition="bottom" [showItemNavigators]="true" [showIndicators]="true" [showThumbnails]="false" [showIndicatorsOnItem]="false"
                      [containerStyle]="galleriaContainerStyle" [numVisible]="0" [(activeIndex)]="activeIndex">
            <ng-template pTemplate="item" let-item>
              <img [src]="getBlobUrl(item)" [alt]="item.originalFilename" class="qna-image"/>
            </ng-template>
            <ng-template pTemplate="caption" let-item>
              <div class="flex">
                <p-button class="align-content-center" size="small" icon="pi pi-times" [rounded]="true" pTooltip="{{removeFileTooltip | translate}}" (click)="deleteUploadFile(item)" />
                <label class="m-1">{{ellipsis(item.file.name)}}</label>
              </div>
            </ng-template>
          </p-galleria>
        </p-card>
      </div>
      <input #inputFiles class="collapse" type="file" [accept]="acceptFiles" (change)="fileSelected($event)" [multiple]="true" />
    </div>
  </p-card>
</div>
